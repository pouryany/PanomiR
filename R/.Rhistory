name.tag <- gsub(".csv","",name.tag)
de.targets[[name.tag]]<- sort(sel.mirs)
n.targets[[name.tag]] <- nrow(res.tab)
}
n.targets
de.targets
all.res  <- list.files("../test_cases/LIHC/Output/cluster_louvain_Prioritization_TargetScan03/",full.names = T)
all.mirs <- readRDS("../Data/TCGA-LIHC-DEmiRNAs.RDS")
de.mirs  <- all.mirs[all.mirs$adj.P.Val<0.0001,]
de.mirs <- rownames_to_column(de.mirs)
de.vec  <- de.mirs$rowname
de.vec  <- paste(de.vec, collapse = "|")
all.mirs <- rownames_to_column(all.mirs)
all.vec  <- all.mirs$rowname
all.vec  <- paste(all.vec, collapse = "|")
de.targets <- list()
n.targets  <- list()
for(res in all.res){
res.tab0 <- read.csv(res,row.names = "X")
res.tab <- res.tab0[res.tab0$AggInv_fdr<0.0001,]
all.ids  <- grep(all.vec,res.tab0$x,value = T)
des.ids  <- grep(de.vec,res.tab0$x,value = T)
sel.mirs <- grep(de.vec,res.tab$x,value = T)
name.tag <- unlist(strsplit(res,"/"))
name.tag <- tail(name.tag,1)
name.tag <- gsub(".csv","",name.tag)
de.targets[[name.tag]]<- sort(sel.mirs)
n.targets[[name.tag]] <- nrow(res.tab)
}
de.targets
n.targets
de.targets
# Compare prioritization results to DE miRNAs. Trying to attribute miRNAs to cluster.
rm(list = ls())
library(dplyr)
library(tibble)
all.res  <- list.files("../test_cases/LIHC/Output/cluster_louvain_Prioritization_TargetScan03/",full.names = T)
all.mirs <- readRDS("../Data/TCGA-LIHC-DEmiRNAs.RDS")
de.mirs  <- all.mirs[all.mirs$adj.P.Val<0.001,]
de.mirs <- rownames_to_column(de.mirs)
de.vec  <- de.mirs$rowname
de.vec  <- paste(de.vec, collapse = "|")
all.mirs <- rownames_to_column(all.mirs)
all.vec  <- all.mirs$rowname
all.vec  <- paste(all.vec, collapse = "|")
de.targets <- list()
n.targets  <- list()
for(res in all.res){
res.tab0 <- read.csv(res,row.names = "X")
res.tab <- res.tab0[res.tab0$AggInv_fdr<0.001,]
all.ids  <- grep(all.vec,res.tab0$x,value = T)
des.ids  <- grep(de.vec,res.tab0$x,value = T)
sel.mirs <- grep(de.vec,res.tab$x,value = T)
name.tag <- unlist(strsplit(res,"/"))
name.tag <- tail(name.tag,1)
name.tag <- gsub(".csv","",name.tag)
de.targets[[name.tag]]<- sort(sel.mirs)
n.targets[[name.tag]] <- nrow(res.tab)
}
de.targets
de.targets
n.targets
de.targets
name.tag
rm(llist = ls())
library(TCGAbiolinks)
library(limma)
library(dplyr)
library(SummarizedExperiment)
library(miRBaseConverter)
# Download from http://firebrowse.org/; miRseq_Mature_Preprocess (MD5)
mirna.data <- read.csv('../Data/LIHC_miRseq_mature_RPM.txt', sep='\t')
rownames(mirna.data)<- sapply(as.character(mirna.data$Gene), function(X){
return(substr(X, 1, nchar(X)-13))
})
mirna.data <- mirna.data %>% dplyr::select(., -c('Gene'))
colnames(mirna.data) <- gsub('\\.', '-', colnames(mirna.data))
mirna.data[is.na(mirna.data)] <- 0
covariates <- read.csv('../Data/TCGA-LIHC-COV.csv', row.names = 1)
mirna.TP.samples <- as.character(covariates[covariates$shortLetterCode == 'TP',]$mirna_sample)
mirna.NT.samples <- as.character(covariates[covariates$shortLetterCode == 'NT',]$mirna_sample)
filter <- rowSums(mirna.data >= 1) >= floor(length(c(mirna.TP.samples, mirna.NT.samples))/20)
temp.mirna.data <- mirna.data[filter, c(mirna.TP.samples, mirna.NT.samples)]
filter
temp.mirna.data <- mirna.data[filter, c(mirna.TP.samples, mirna.NT.samples)]
IDs <- get_IDs(temp.mirna.data)
type <- factor(c(rep('TP', length(mirna.TP.samples)),rep('NT',length(mirna.NT.samples))))
batch <- factor(IDs$plate)
design <- model.matrix(~0+type+batch)
fit <- lmFit(log(temp.mirna.data+3), design)
contr <- makeContrasts(typeTP-typeNT, levels = colnames(coef(fit)))
fit <- contrasts.fit(fit, contr)
fit <- eBayes(fit, trend=T)
tt <- topTable(fit, coef = 1, number=Inf)
View(tt)
IDs <- get_IDs(temp.mirna.data)
type <- factor(c(rep('TP', length(mirna.TP.samples)),rep('NT',length(mirna.NT.samples))))
batch <- factor(IDs$plate)
design <- model.matrix(~type+batch)
fit <- lmFit(log(temp.mirna.data+3), design)
contr <- makeContrasts(typeTP-typeNT, levels = colnames(coef(fit)))
fit <- contrasts.fit(fit, contr)
type
batch <- factor(IDs$plate)
design <- model.matrix(~type+batch)
design
fit <- lmFit(log(temp.mirna.data+3), design)
contr <- makeContrasts(typeTP-typeNT, levels = colnames(coef(fit)))
fit <- contrasts.fit(fit, contr)
coef(fit)
IDs <- get_IDs(temp.mirna.data)
type <- factor(c(rep('TP', length(mirna.TP.samples)),rep('NT',length(mirna.NT.samples))))
batch <- factor(IDs$plate)
design <- model.matrix(~0+type+batch)
fit <- lmFit(log(temp.mirna.data+3), design)
contr <- makeContrasts(typeTP-typeNT, levels = colnames(coef(fit)))
fit <- contrasts.fit(fit, contr)
fit <- eBayes(fit, trend=T)
tt <- topTable(fit, coef = 1, number=Inf)
tt
filter
floor(length(c(mirna.TP.samples, mirna.NT.samples))/20)
length(c(mirna.TP.samples, mirna.NT.samples)
)
length(c(mirna.TP.samples, mirna.NT.samples))/20
floor(length(c(mirna.TP.samples, mirna.NT.samples))/20)
rm(llist = ls())
library(TCGAbiolinks)
library(limma)
library(dplyr)
library(SummarizedExperiment)
library(miRBaseConverter)
# GDCdownload(query3, directory = '../GDCdata')
# mirna.data <- GDCprepare(query2, directory = '../GDCdata')
# mirna.names <- miRNA_NameToAccession(mirna.data$miRNA_ID)
# mirna.ids <- miRNA_AccessionToName(mirna.names$Accession, targetVersion = 'v21')
# Download from http://firebrowse.org/; miRseq_Mature_Preprocess (MD5)
mirna.data <- read.csv('../Data/LIHC_miRseq_mature_RPM.txt', sep='\t')
rownames(mirna.data)<- sapply(as.character(mirna.data$Gene), function(X){
return(substr(X, 1, nchar(X)-13))
})
mirna.data <- mirna.data %>% dplyr::select(., -c('Gene'))
colnames(mirna.data) <- gsub('\\.', '-', colnames(mirna.data))
mirna.data[is.na(mirna.data)] <- 0
#
# filter <- (rowSums(mirna.data[,mirna.TP.samples] > 1) >= floor(length(mirna.TP.samples)/2) &
#              rowSums(mirna.data[,mirna.NT.samples] > 1) >= floor(length(mirna.NT.samples)/2))
covariates <- read.csv('../Data/TCGA-LIHC-COV.csv', row.names = 1)
mirna.TP.samples <- as.character(covariates[covariates$shortLetterCode == 'TP',]$mirna_sample)
mirna.NT.samples <- as.character(covariates[covariates$shortLetterCode == 'NT',]$mirna_sample)
filter <- rowSums(mirna.data >= 1) >= floor(length(c(mirna.TP.samples, mirna.NT.samples))/20)
temp.mirna.data <- mirna.data[filter, c(mirna.TP.samples, mirna.NT.samples)]
# mirna.data <- mirna.data[,c(mirna.TP.samples, mirna.NT.samples)]
# saveRDS(mirna.data, '../Data/TCGA-LIHC-miRNA-COUNTS.RDS')
IDs <- get_IDs(temp.mirna.data)
type <- factor(c(rep('TP', length(mirna.TP.samples)),rep('NT',length(mirna.NT.samples))))
batch <- factor(IDs$plate)
design <- model.matrix(~0+type+batch)
fit <- lmFit(log(temp.mirna.data+3), design)
contr <- makeContrasts(typeTP-typeNT, levels = colnames(coef(fit)))
fit <- contrasts.fit(fit, contr)
fit <- eBayes(fit, trend=T)
tt <- topTable(fit, coef = 1, number=Inf)
saveRDS(tt, file=paste0('../Data/TCGA-LIHC-DEmiRNAs.RDS'))
tt
# Compare prioritization results to DE miRNAs. Trying to attribute miRNAs to cluster.
rm(list = ls())
library(dplyr)
library(tibble)
all.res  <- list.files("../test_cases/LIHC/Output/cluster_louvain_Prioritization_TargetScan03/",full.names = T)
all.mirs <- readRDS("../Data/TCGA-LIHC-DEmiRNAs.RDS")
de.mirs  <- all.mirs[all.mirs$adj.P.Val<0.001,]
de.mirs
de.mirs <- rownames_to_column(de.mirs)
de.vec  <- de.mirs$rowname
de.vec  <- paste(de.vec, collapse = "|")
all.mirs <- rownames_to_column(all.mirs)
all.vec  <- all.mirs$rowname
all.vec  <- paste(all.vec, collapse = "|")
de.targets <- list()
n.targets  <- list()
for(res in all.res){
res.tab0 <- read.csv(res,row.names = "X")
res.tab <- res.tab0[res.tab0$AggInv_fdr<0.001,]
all.ids  <- grep(all.vec,res.tab0$x,value = T)
des.ids  <- grep(de.vec,res.tab0$x,value = T)
sel.mirs <- grep(de.vec,res.tab$x,value = T)
name.tag <- unlist(strsplit(res,"/"))
name.tag <- tail(name.tag,1)
name.tag <- gsub(".csv","",name.tag)
de.targets[[name.tag]]<- sort(sel.mirs)
n.targets[[name.tag]] <- nrow(res.tab)
}
n.targets
de.targets
View(all.mirs)
all.res  <- list.files("../test_cases/LIHC/Output/cluster_louvain_Prioritization_Tarbase/",full.names = T)
all.mirs <- readRDS("../Data/TCGA-LIHC-DEmiRNAs.RDS")
de.mirs  <- all.mirs[all.mirs$adj.P.Val<0.01,]
de.mirs <- rownames_to_column(de.mirs)
de.vec  <- de.mirs$rowname
de.vec  <- paste(de.vec, collapse = "|")
all.mirs <- rownames_to_column(all.mirs)
all.vec  <- all.mirs$rowname
all.vec  <- paste(all.vec, collapse = "|")
de.targets <- list()
n.targets  <- list()
for(res in all.res){
res.tab0 <- read.csv(res,row.names = "X")
res.tab <- res.tab0[res.tab0$AggInv_fdr<0.001,]
all.ids  <- grep(all.vec,res.tab0$x,value = T)
des.ids  <- grep(de.vec,res.tab0$x,value = T)
sel.mirs <- grep(de.vec,res.tab$x,value = T)
name.tag <- unlist(strsplit(res,"/"))
name.tag <- tail(name.tag,1)
name.tag <- gsub(".csv","",name.tag)
de.targets[[name.tag]]<- sort(sel.mirs)
n.targets[[name.tag]] <- nrow(res.tab)
}
de.targets
n.targets
de.targets
sel.mirs
name.tag
name.tag  <- unlist(strsplit(res,"/"))
name.tag  <- tail(name.tag,1)
name.tag
name.tag  <- gsub(".csv","",name.tag)
name.tag
clust_tag <- tail(unlist(strsplit(name.tag,"_")),1)
clust_tag
de.targets <- list()
n.targets  <- list()
for(res in all.res){
res.tab0 <- read.csv(res,row.names = "X")
res.tab <- res.tab0[res.tab0$AggInv_fdr<0.001,]
all.ids  <- grep(all.vec,res.tab0$x,value = T)
des.ids  <- grep(de.vec,res.tab0$x,value = T)
sel.mirs <- grep(de.vec,res.tab$x,value = T)
name.tag  <- unlist(strsplit(res,"/"))
name.tag  <- tail(name.tag,1)
name.tag  <- gsub(".csv","",name.tag)
clust_tag <- tail(unlist(strsplit(name.tag,"_")),1)
de.targets[[name.tag]]<- data.frame(cluster = clust_tag , miRNA = sort(sel.mirs))
n.targets[[name.tag]] <- nrow(res.tab)
}
de.targets <- list()
n.targets  <- list()
for(res in all.res){
res.tab0 <- read.csv(res,row.names = "X")
res.tab <- res.tab0[res.tab0$AggInv_fdr<0.001,]
all.ids  <- grep(all.vec,res.tab0$x,value = T)
des.ids  <- grep(de.vec,res.tab0$x,value = T)
sel.mirs <- grep(de.vec,res.tab$x,value = T)
name.tag  <- unlist(strsplit(res,"/"))
name.tag  <- tail(name.tag,1)
name.tag  <- gsub(".csv","",name.tag)
clust_tag <- tail(unlist(strsplit(name.tag,"_")),1)
if(length(sel.mirs)>0)
de.targets[[name.tag]] <- data.frame(cluster = clust_tag ,
miRNA = sort(sel.mirs))
n.targets[[name.tag]]  <- nrow(res.tab)
}
de.targets
Reduce(rbind, de.targets)
write.csv(de.targets, "../test_cases/LIHC/Output/DE_prioritzed_TargetScan.csv")
de.targets
de.targets <- Reduce(rbind, de.targets)
write.csv(de.targets, "../test_cases/LIHC/Output/DE_prioritzed_TargetScan.csv")
write.csv(de.targets, "../test_cases/LIHC/Output/DE_prioritzed_Tarbase.csv")
all.res  <- list.files("../test_cases/LIHC/Output/cluster_louvain_Prioritization_TargetScan03/",full.names = T)
all.mirs <- readRDS("../Data/TCGA-LIHC-DEmiRNAs.RDS")
de.mirs  <- all.mirs[all.mirs$adj.P.Val<0.01,]
de.mirs <- rownames_to_column(de.mirs)
de.vec  <- de.mirs$rowname
de.vec  <- paste(de.vec, collapse = "|")
all.mirs <- rownames_to_column(all.mirs)
all.vec  <- all.mirs$rowname
all.vec  <- paste(all.vec, collapse = "|")
de.targets <- list()
n.targets  <- list()
for(res in all.res){
res.tab0 <- read.csv(res,row.names = "X")
res.tab <- res.tab0[res.tab0$AggInv_fdr<0.001,]
all.ids  <- grep(all.vec,res.tab0$x,value = T)
des.ids  <- grep(de.vec,res.tab0$x,value = T)
sel.mirs <- grep(de.vec,res.tab$x,value = T)
name.tag  <- unlist(strsplit(res,"/"))
name.tag  <- tail(name.tag,1)
name.tag  <- gsub(".csv","",name.tag)
clust_tag <- tail(unlist(strsplit(name.tag,"_")),1)
if(length(sel.mirs)>0)
de.targets[[name.tag]] <- data.frame(cluster = clust_tag ,
miRNA = sort(sel.mirs))
n.targets[[name.tag]]  <- nrow(res.tab)
}
de.targets <- Reduce(rbind, de.targets)
write.csv(de.targets, "../test_cases/LIHC/Output/DE_prioritzed_TargetScan.csv")
de.targets
all.mirs
write.csv(all.mirs, "../test_cases/LIHC/Output/DE_miRs.csv")
# Compare prioritization results to DE miRNAs. Trying to attribute miRNAs to cluster.
rm(list = ls())
library(dplyr)
library(tibble)
all.res  <- list.files("../test_cases/LIHC/Output/cluster_louvain_Prioritization_Tarbase/",full.names = T)
all.mirs <- readRDS("../Data/TCGA-LIHC-DEmiRNAs.RDS")
de.mirs  <- all.mirs[all.mirs$adj.P.Val<0.01,]
de.mirs <- rownames_to_column(de.mirs)
de.vec  <- de.mirs$rowname
de.vec  <- paste(de.vec, collapse = "|")
all.mirs <- rownames_to_column(all.mirs)
all.vec  <- all.mirs$rowname
all.vec  <- paste(all.vec, collapse = "|")
de.targets <- list()
n.targets  <- list()
for(res in all.res){
res.tab0 <- read.csv(res,row.names = "X")
res.tab <- res.tab0[res.tab0$AggInv_fdr<0.001,]
all.ids  <- grep(all.vec,res.tab0$x,value = T)
des.ids  <- grep(de.vec,res.tab0$x,value = T)
sel.mirs <- grep(de.vec,res.tab$x,value = T)
name.tag  <- unlist(strsplit(res,"/"))
name.tag  <- tail(name.tag,1)
name.tag  <- gsub(".csv","",name.tag)
clust_tag <- tail(unlist(strsplit(name.tag,"_")),1)
if(length(sel.mirs)>0)
de.targets[[name.tag]] <- data.frame(cluster = clust_tag ,
miRNA = sort(sel.mirs))
n.targets[[name.tag]]  <- nrow(res.tab)
}
de.targets1 <- Reduce(rbind, de.targets)
write.csv(de.targets1, "../test_cases/LIHC/Output/DE_prioritzed_Tarbase.csv")
write.csv(all.mirs, "../test_cases/LIHC/Output/DE_miRs.csv")
de.targets1
de.targets
setdiff(de.targets$x2_LIHCGene_Tarbase1000_samples_clustNo_1$miRNA,
de.targets$x2_LIHCGene_Tarbase1000_samples_clustNo_2$miRNA)
setdiff(de.targets$x2_LIHCGene_Tarbase1000_samples_clustNo_2$miRNA,
de.targets$x2_LIHCGene_Tarbase1000_samples_clustNo_1$miRNA)
a1 <- setdiff(de.targets$x2_LIHCGene_Tarbase1000_samples_clustNo_1$miRNA,
de.targets$x2_LIHCGene_Tarbase1000_samples_clustNo_2$miRNA)
a1 <- setdiff(de.targets$x2_LIHCGene_Tarbase1000_samples_clustNo_1$miRNA,
de.targets$x2_LIHCGene_Tarbase1000_samples_clustNo_2$miRNA)
a2 <- setdiff(de.targets$x2_LIHCGene_Tarbase1000_samples_clustNo_2$miRNA,
de.targets$x2_LIHCGene_Tarbase1000_samples_clustNo_1$miRNA)
write.csv(a1, "../test_cases/LIHC/Output/DE_prioritzed_Tarbase_Unique_1.csv")
write.csv(a2, "../test_cases/LIHC/Output/DE_prioritzed_Tarbase_Unique_2.csv")
a1
a2, "../test_cases/LIHC/Output/DE_prioritzed_Tarbase_Unique_2.csv"
a2
de.targets1
a1
a2
all.res  <- list.files("../test_cases/LIHC/Output/cluster_louvain_Prioritization_TargetScan03/",full.names = T)
all.mirs <- readRDS("../Data/TCGA-LIHC-DEmiRNAs.RDS")
de.mirs  <- all.mirs[all.mirs$adj.P.Val<0.01,]
de.mirs <- rownames_to_column(de.mirs)
de.vec  <- de.mirs$rowname
de.vec  <- paste(de.vec, collapse = "|")
all.mirs <- rownames_to_column(all.mirs)
all.vec  <- all.mirs$rowname
all.vec  <- paste(all.vec, collapse = "|")
de.targets <- list()
n.targets  <- list()
for(res in all.res){
res.tab0 <- read.csv(res,row.names = "X")
res.tab <- res.tab0[res.tab0$AggInv_fdr<0.001,]
all.ids  <- grep(all.vec,res.tab0$x,value = T)
des.ids  <- grep(de.vec,res.tab0$x,value = T)
sel.mirs <- grep(de.vec,res.tab$x,value = T)
name.tag  <- unlist(strsplit(res,"/"))
name.tag  <- tail(name.tag,1)
name.tag  <- gsub(".csv","",name.tag)
clust_tag <- tail(unlist(strsplit(name.tag,"_")),1)
if(length(sel.mirs)>0)
de.targets[[name.tag]] <- data.frame(cluster = clust_tag ,
miRNA = sort(sel.mirs))
n.targets[[name.tag]]  <- nrow(res.tab)
}
de.targets <- Reduce(rbind, de.targets)
de.targets
de.targets <- list()
n.targets  <- list()
for(res in all.res){
res.tab0 <- read.csv(res,row.names = "X")
res.tab <- res.tab0[res.tab0$AggInv_fdr<0.001,]
all.ids  <- grep(all.vec,res.tab0$x,value = T)
des.ids  <- grep(de.vec,res.tab0$x,value = T)
sel.mirs <- grep(de.vec,res.tab$x,value = T)
name.tag  <- unlist(strsplit(res,"/"))
name.tag  <- tail(name.tag,1)
name.tag  <- gsub(".csv","",name.tag)
clust_tag <- tail(unlist(strsplit(name.tag,"_")),1)
if(length(sel.mirs)>0)
de.targets[[name.tag]] <- data.frame(cluster = clust_tag ,
miRNA = sort(sel.mirs))
n.targets[[name.tag]]  <- nrow(res.tab)
}
a1 <- setdiff(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_1$miRNA,
union(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_2$miRNA,
de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_3$miRNA))
a1
a1 <- setdiff(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_1$miRNA,
union(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_2$miRNA,
de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_3$miRNA))
a2 <- setdiff(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_2$miRNA,
union(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_1$miRNA,
de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_3$miRNA))
a1 <- setdiff(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_1$miRNA,
union(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_2$miRNA,
de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_3$miRNA))
a2 <- setdiff(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_2$miRNA,
union(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_1$miRNA,
de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_3$miRNA))
a3 <- setdiff(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_3$miRNA,
union(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_1$miRNA,
de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_2$miRNA))
a3
a1 <- setdiff(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_1$miRNA,
union(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_2$miRNA,
de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_3$miRNA))
a2 <- setdiff(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_2$miRNA,
union(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_1$miRNA,
de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_3$miRNA))
a3 <- setdiff(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_3$miRNA,
union(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_1$miRNA,
de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_2$miRNA))
a3
a2
a1
write.csv(a1, "../test_cases/LIHC/Output/DE_prioritzed_TargetScan_Unique_1.csv")
write.csv(a2, "../test_cases/LIHC/Output/DE_prioritzed_TargetScan_Unique_2.csv")
write.csv(a3, "../test_cases/LIHC/Output/DE_prioritzed_TargetScan_Unique_3.csv")
de.targets <- Reduce(rbind, de.targets)
de.targets
# Compare prioritization results to DE miRNAs. Trying to attribute miRNAs to cluster.
rm(list = ls())
library(dplyr)
library(tibble)
all.res  <- list.files("../test_cases/LIHC/Output/cluster_louvain_Prioritization_Tarbase/",full.names = T)
all.mirs <- readRDS("../Data/TCGA-LIHC-DEmiRNAs.RDS")
de.mirs  <- all.mirs[all.mirs$adj.P.Val<0.01,]
de.mirs <- rownames_to_column(de.mirs)
de.vec  <- de.mirs$rowname
de.vec  <- paste(de.vec, collapse = "|")
all.mirs <- rownames_to_column(all.mirs)
all.vec  <- all.mirs$rowname
all.vec  <- paste(all.vec, collapse = "|")
de.targets <- list()
n.targets  <- list()
for(res in all.res){
res.tab0 <- read.csv(res,row.names = "X")
res.tab <- res.tab0[res.tab0$AggInv_fdr<0.001,]
all.ids  <- grep(all.vec,res.tab0$x,value = T)
des.ids  <- grep(de.vec,res.tab0$x,value = T)
sel.mirs <- grep(de.vec,res.tab$x,value = T)
name.tag  <- unlist(strsplit(res,"/"))
name.tag  <- tail(name.tag,1)
name.tag  <- gsub(".csv","",name.tag)
clust_tag <- tail(unlist(strsplit(name.tag,"_")),1)
if(length(sel.mirs)>0)
de.targets[[name.tag]] <- data.frame(cluster = clust_tag ,
miRNA = sort(sel.mirs))
n.targets[[name.tag]]  <- nrow(res.tab)
}
de.targets1 <- Reduce(rbind, de.targets)
a1 <- setdiff(de.targets$x2_LIHCGene_Tarbase1000_samples_clustNo_1$miRNA,
de.targets$x2_LIHCGene_Tarbase1000_samples_clustNo_2$miRNA)
a2 <- setdiff(de.targets$x2_LIHCGene_Tarbase1000_samples_clustNo_2$miRNA,
de.targets$x2_LIHCGene_Tarbase1000_samples_clustNo_1$miRNA)
a1
a2
all.res  <- list.files("../test_cases/LIHC/Output/cluster_louvain_Prioritization_TargetScan03/",full.names = T)
all.mirs <- readRDS("../Data/TCGA-LIHC-DEmiRNAs.RDS")
de.mirs  <- all.mirs[all.mirs$adj.P.Val<0.01,]
de.mirs <- rownames_to_column(de.mirs)
de.vec  <- de.mirs$rowname
de.vec  <- paste(de.vec, collapse = "|")
all.mirs <- rownames_to_column(all.mirs)
all.vec  <- all.mirs$rowname
all.vec  <- paste(all.vec, collapse = "|")
de.targets <- list()
n.targets  <- list()
for(res in all.res){
res.tab0 <- read.csv(res,row.names = "X")
res.tab <- res.tab0[res.tab0$AggInv_fdr<0.001,]
all.ids  <- grep(all.vec,res.tab0$x,value = T)
des.ids  <- grep(de.vec,res.tab0$x,value = T)
sel.mirs <- grep(de.vec,res.tab$x,value = T)
name.tag  <- unlist(strsplit(res,"/"))
name.tag  <- tail(name.tag,1)
name.tag  <- gsub(".csv","",name.tag)
clust_tag <- tail(unlist(strsplit(name.tag,"_")),1)
if(length(sel.mirs)>0)
de.targets[[name.tag]] <- data.frame(cluster = clust_tag ,
miRNA = sort(sel.mirs))
n.targets[[name.tag]]  <- nrow(res.tab)
}
a1 <- setdiff(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_1$miRNA,
union(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_2$miRNA,
de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_3$miRNA))
a2 <- setdiff(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_2$miRNA,
union(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_1$miRNA,
de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_3$miRNA))
a3 <- setdiff(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_3$miRNA,
union(de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_1$miRNA,
de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_2$miRNA))
a1
a2
a3
de.targets$x2_LIHCGene_TargetScan031000_samples_clustNo_3$miRNA
